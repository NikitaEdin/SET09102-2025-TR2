-- Nikita Roles Table
CREATE TABLE IF NOT EXISTS Roles (
    role_id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    description TEXT,
    power INTEGER
);


-- Nikita Users Table
CREATE TABLE Users (
    user_id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT NOT NULL,
    name TEXT NOT NULL,
    password TEXT NOT NULL,
    role_id INTEGER,
    FOREIGN KEY (role_id) REFERENCES Roles(role_id) ON DELETE SET NULL
);

CREATE TABLE Sites (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT,
    latitude REAL,
    longitude REAL,
    elevation INTEGER,
    timezone TEXT,
    utc_offset INTEGER,
    type TEXT,
    zone TEXT,
    Agglomeration TEXT,
    Local_authority TEXT
);

CREATE TABLE Sensors (
    sensor_id INTEGER PRIMARY KEY AUTOINCREMENT,
    site_id INTEGER NOT NULL,
    sensor_type TEXT NOT NULL,
    sensor_url TEXT,
    deployment_date TEXT,
    sensor_operational BOOLEAN
   -- configID INTEGER, Circular Dependency with Sensor
   -- FOREIGN KEY (configID) REFERENCES Configuration(ConfigID) ON DELETE SET NULL
);

CREATE TABLE Configuration (
    config_id INTEGER PRIMARY KEY AUTOINCREMENT,
    sensor_id INTEGER NOT NULL,
    min_measurement REAL NOT NULL,
    max_measurement REAL NOT NULL,
    type TEXT NOT NULL,
   -- unit TEXT NOT NULL, This isn't needed 
    firmware REAL, -- assuming firmware is a file, stored as BLOB (REAL Datetype for now)
    FOREIGN KEY (sensor_id) REFERENCES Sensors(sensor_id) ON DELETE CASCADE
);

-- Nikita Metadata Table
CREATE TABLE IF NOT EXISTS Metadata (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    category TEXT NOT NULL,
    quantity TEXT NOT NULL,
    symbol TEXT NOT NULL,
    unit TEXT NOT NULL,
    unit_desc TEXT,
    measurement_freq TEXT,
    safe_level REAL,
    sensor TEXT,
    reference_url TEXT,
    sensor_id INTEGER,
    FOREIGN KEY (sensor_id) REFERENCES Sensors(sensor_id)
);


-- Nikita Water Measurements Table
CREATE TABLE IF NOT EXISTS WaterMeasurements (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    datetime TEXT NOT NULL,
    nitrate REAL,
    nitrite REAL,
    phosphate REAL,
    ec REAL,
    metadata INTEGER,
    FOREIGN KEY (metadata) REFERENCES Metadata(ID)
);


-- Rachael Weather Measurements Table
CREATE TABLE IF NOT EXISTS WeatherMeasurements (
    weather_measurements_id INTEGER PRIMARY KEY AUTOINCREMENT,
    date_time TEXT NOT NULL,
    temperature_2m REAL,
    relative_humidity_2m REAL,
    wind_speed_10m REAL,
    wind_direction_10m REAL,
    metadata INTEGER,
    FOREIGN KEY (metadata) REFERENCES Metadata(ID)
);


-- Rachael Air Measurements Table
CREATE TABLE IF NOT EXISTS AirMeasurements (
    air_measurements_id INTEGER PRIMARY KEY AUTOINCREMENT,
    date_time TEXT NOT NULL,
    nitrogen_dioxide REAL,
    sulphur_dioxide REAL,
    pm2_5 REAL,
    pm10 REAL,
    metadata INTEGER,
    FOREIGN KEY (metadata) REFERENCES Metadata(ID)
);